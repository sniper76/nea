<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jobcenter">

	<sql id="whereCond">
		<!-- 검색조건,search condition -->
		<where>
		<choose>
			<when test="condText != null and !condText.equals('') and !langCd.equals('KH')"><!-- 선택언어가 KH가 아닌경우 -->
				<choose>
		   			<when test="condType == null or condType.equals('')">
		   				AND ( A.JC_EN LIKE CONCAT('%',#{condText},'%')
		   				      OR A.ADDR_EN LIKE CONCAT('%',#{condText},'%')
		   				)
					</when>
					<when test="condType != null and condType.equals('TITLE')">
						 AND A.JC_EN LIKE CONCAT('%',#{condText},'%')
					</when>
					<when test="condType != null and condType.equals('CONTENT')">
						 AND A.ADDR_EN LIKE CONCAT('%',#{condText},'%')
					</when>
				</choose>
			</when>
			<when test="condText != null and !condText.equals('') and langCd.equals('KH')"><!-- 선택언어가 KH인경우 -->
				<choose>
		   			<when test="condType == null or condType.equals('')">
		   				AND ( A.JC_KH LIKE CONCAT('%',#{condText},'%')
		   				      OR A.ADDR_KH LIKE CONCAT('%',#{condText},'%')
		   				)
					</when>
					<when test="condType != null and condType.equals('TITLE')">
						 AND A.JC_KH LIKE CONCAT('%',#{condText},'%')
					</when>
					<when test="condType != null and condType.equals('CONTENT')">
						 AND A.ADDR_KH LIKE CONCAT('%',#{condText},'%')
					</when>
				</choose>
			</when>
		</choose>
		</where>
	</sql>

	<sql id="sortCond">
		ORDER BY A.JC_KH DESC
		<choose>
			<when test="condSort != null and condSort.equals('LATEST')">
				,A.REG_DT DESC
			</when>
			<otherwise>
   				,A.REG_DT ASC
			</otherwise>
		</choose>
	</sql>

    <!-- jobcenter list count info  -->
	<select id="selectJobCenterListCnt" resultType="java.lang.Integer" parameterType="ony.cpes.external.jobcenter.bean.CondJobCenterBean">
		/*jobcenter.selectJobCenterListCnt*/
		SELECT COUNT(1) AS CNT
		FROM CPES_JOB_CENTER A
 		<include refid="whereCond"/>

	</select>

    <!-- jobcenter list info  -->
	<select id="selectJobCenterList" resultType="ony.cpes.external.jobcenter.bean.JobCenterBean" parameterType="ony.cpes.external.jobcenter.bean.CondJobCenterBean">
		/*jobcenter.selectJobCenterList*/
		SELECT
		  JC_CD,
		  CASE WHEN UPPER('KO') = 'KH' THEN JC_KH
				ELSE JC_EN
				END AS JC,
		  JC_EN,
		  JC_KH,
		  CASE WHEN UPPER('KO') = 'KH' THEN ADDR_KH
				ELSE ADDR_EN
				END AS ADDR,
		  ADDR_EN,
		  ADDR_KH,
		  TEL1,
		  TEL2,
		  TEL3,
		  TEL4,
		  EMAIL,
		  FACEBOOK,
		  WEBSITE,
		  FILE_GRP_SEQ,
		  ADDR_CD,
		  CASE WHEN UPPER('KO') = 'KH' THEN EXPLN_KH
				ELSE EXPLN_EN
				END AS ADDR,
		  EXPLN_EN,
		  EXPLN_KH,
		  LNGTD,
		  LATTD,
		  REG_USER_SEQ,
		  FN_GET_BASE_DATE_CHAR(REG_DT,'KO') AS REG_DT,
		  MOD_USER_SEQ,
		  FN_GET_BASE_DATE_CHAR(MOD_DT,'KO') AS MOD_DT,
		  USE_YN,
		  MAP_LINK,
		  ADDR_FULL_CD,
		  ADDR_FULL_NM,
		  FN_GET_NEW_YN(A.REG_DT) AS NEW_YN,
		  FN_GET_FILE_PATH(A.FILE_GRP_SEQ) AS FILE_PATH
		FROM CPES_JOB_CENTER A
        <include refid="whereCond"/>
		<include refid="sortCond"/>
       	LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

    <!-- jobcenter info  -->
	<select id="selectJobCenter" resultType="ony.cpes.external.jobcenter.bean.JobCenterBean" parameterType="ony.cpes.external.jobcenter.bean.CondJobCenterBean">
		/*jobcenter.selectJobCenter*/
		SELECT
		  JC_CD,
		  CASE WHEN UPPER('KO') = 'KH' THEN JC_KH
				ELSE JC_EN
				END AS JC,
		  JC_EN,
		  JC_KH,
		  CASE WHEN UPPER('KO') = 'KH' THEN ADDR_KH
				ELSE ADDR_EN
				END AS ADDR,
		  ADDR_EN,
		  ADDR_KH,
		  TEL1,
		  TEL2,
		  TEL3,
		  TEL4,
		  EMAIL,
		  FACEBOOK,
		  WEBSITE,
		  FILE_GRP_SEQ,
		  ADDR_CD,
		  CASE WHEN UPPER('KO') = 'KH' THEN EXPLN_KH
				ELSE EXPLN_EN
				END AS ADDR,
		  EXPLN_EN,
		  EXPLN_KH,
		  LNGTD,
		  LATTD,
		  REG_USER_SEQ,
		  FN_GET_BASE_DATE_CHAR(REG_DT,'KO') AS REG_DT,
		  MOD_USER_SEQ,
		  FN_GET_BASE_DATE_CHAR(MOD_DT,'KO') AS MOD_DT,
		  USE_YN,
		  MAP_LINK,
		  ADDR_FULL_CD,
		  ADDR_FULL_NM
		FROM CPES_JOB_CENTER A
		WHERE JC_CD = #{condSeq}
	</select>

</mapper>
