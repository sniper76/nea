<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="setMember">



	<!-- insertMember -->
    <insert id="insertMember" parameterType="ony.cpes.external.member.bean.MemberBean">
		/*setMember.insertMember*/
		INSERT INTO CPES_USER
			(
				ACCNT_LOCK_STS_CD,
				ADDR_CD,
				ADDR_DTL,
				ADDR_FULL_CD,
				ADDR_FULL_NM,
				AUTH_CMPLT_YN,
				BIRTH,
				CONCIL_REQ_YN,
				DEL_YN,
				DORMANCY_YN,
				EMAIL_NTCE_AGREE_YN,
				EMAIL_USER_AUTH_VALUE,
				FILE_GRP_SEQ,
				GENDER_CD,
				INFO_OPEN_YN,
				INFO_PROVD_INFO_AGREE_YN,
				JC_CD,
				JOBSK_STS_CD,
				JOIN_ROUTE_DIV_CD,
				LAST_LOGIN_DT,
				LAST_LOGIN_IP,
				MEMB_TAC_AGREE_YN,
				MNG_ID,
				MNG_YN,
				MOD_DT,
				MOD_USER_SEQ,
				NEW_PWD_APPLY_YN,
				NID,
				PRIVATE_INFO_COLLCT_AGREE_YN,
				PRIVATE_INFO_USE_AGREE_YN,
				PWD_CREAT_DT,
				PWD_FAIL_CNT,
				REG_DT,
				REG_USER_SEQ,
				SMS_EMAIL_AUTH_DIV_CD,
				SMS_NTCE_AGREE_YN,
				USE_YN,
				USER_AUTH_CD,
				USER_CELL,
				USER_EMAIL,
				USER_GRP_CD,
				USER_ID,
				USER_NM_EN,
				USER_NM_KH,
				USER_PWD,
				USER_PWD_OLD,
				USER_SEQ,
				USER_STS_CD,
				WTHDR_REASON,
				WTHDR_REASON_CD
		) VALUES (
			'ALS0000000001',
			#{addrCd},
			#{addrDtl},
			#{addrFullCd},
			#{addrFullNm},
			#{authCmpltYn},
			#{birth},
			#{concilReqYn},
			'N',
			'N',
			#{emailNtceAgreeYn},
			#{emailUserAuthValue},
			#{fileGrpSeq},
			#{genderCd},
			#{infoOpenYn},
			#{infoProvdInfoAgreeYn},
			IFNULL(FN_GET_ADDR_CD_BY_JC_CD(#{addrFullCd}),'JCT0000000015'),
			#{jobskStsCd},
			'RNG0000000003',
			#{lastLoginDt},
			#{lastLoginIp},
			#{membTacAgreeYn},
			#{mngId},
			#{mngYn},
			now(),
			#{userSeq},
			'Y',
			#{nid},
			#{privateInfoCollctAgreeYn},
			#{privateInfoCollctAgreeYn},
			now(),
			0,
			now(),
			#{userSeq},
			#{smsEmailAuthDivCd},
			#{emailNtceAgreeYn},
			'Y',
			#{userAuthCd},
			#{userCell},
			#{userEmail},
			#{userGrpCd},
			#{userId},
			#{userNmEn},
			#{userNmKh},
			#{userPwd},
			#{userPwdOld},
			#{userSeq},
			'USS0000000000',
			#{wthdrReason},
			'BAN0000000000'
		)
    </insert>


	<!-- insertCompany -->
    <insert id="insertCompany" parameterType="ony.cpes.external.member.bean.CompanyBean">
		/*setMember.insertCompany*/
		<selectKey resultType="string" keyProperty="compnySeq" order="BEFORE">
        	SELECT FN_GET_UUID_SEQ() AS STR FROM DUAL
    	</selectKey>
		INSERT INTO CPES_COMPNY
			(
				ADDR_CD,
				ADDR_DTL,
				ADDR_FULL_CD,
				ADDR_FULL_NM,
				BKMK_CNT,
				COMPNY_FACEBOOK,
				COMPNY_FAX,
				COMPNY_ID,
				COMPNY_NM_EN,
				COMPNY_NM_KH,
				COMPNY_SEQ,
				COMPNY_TYPE_CD,
				COMPNY_WEBSITE,
				DEL_YN,
				DISABL_EMPLOYEE_TOT_CNT,
				EMPLOYEE_TOT_CNT,
				FEMALE_EMPLOYEE_TOT_CNT,
				FILE_GRP_SEQ,
				FORGNER_TOT_CNT,
				ISCO_CD,
				ISIC_CD,
				JC_CD,
				JC_USER_SEQ,
				LATTD,
				LIKE_CNT,
				LNGTD,
				MAIN_JOB_NM,
				MAIN_JOB_PERCENT,
				MNGER_CELL,
				MNGER_EMAIL,
				MNGER_NM,
				MNGER_POSITION,
				MNGER_TEL,
				MOD_DT,
				MOD_USER_SEQ,
				OWNER_NATION_CD,
				PATENT_NUM,
				PROFILE,
				REG_DT,
				REG_NUM,
				REG_USER_SEQ,
				USE_YN,
				USER_ID,
				USER_SEQ,
				GOOGLE_MAP_LINK,
				SUB_MNGER_NM,
				SUB_MNGER_POSITION,
				SUB_MNGER_CELL,
				SUB_MNGER_EMAIL
		) VALUES (
				#{addrCd},
				#{addrDtl},
				#{addrFullCd},
				#{addrFullNm},
				0,
				#{compnyFacebook},
				#{compnyFax},
				#{compnyId},
				#{compnyNmEn},
				#{compnyNmKh},
				#{compnySeq},
				#{compnyTypeCd},
				#{compnyWebsite},
				'N',
				CASE WHEN #{disablEmployeeTotCnt} = '' OR #{disablEmployeeTotCnt} = NULL THEN 0 ELSE #{disablEmployeeTotCnt} END,
				CASE WHEN #{employeeTotCnt} = '' OR #{employeeTotCnt} = NULL THEN 0 ELSE #{employeeTotCnt} END,
				CASE WHEN #{femaleEmployeeTotCnt} = '' OR #{femaleEmployeeTotCnt} = NULL THEN 0 ELSE #{femaleEmployeeTotCnt} END,
				#{fileGrpSeq},
				CASE WHEN #{forgnerTotCnt} = '' OR #{forgnerTotCnt} = NULL THEN 0 ELSE #{forgnerTotCnt} END,
				#{iscoCd},
				#{isicCd},
				IFNULL(FN_GET_ADDR_CD_BY_JC_CD(#{addrFullCd}),'JCT0000000015'),
				#{jcUserSeq},
				#{lattd},
				0,
				#{lngtd},
				#{mainJobNm},
				#{mainJobPercent},
				#{mngerCell},
				#{mngerEmail},
				#{mngerNm},
				#{mngerPosition},
				#{mngerTel},
				now(),
				#{userSeq},
				#{ownerNationCd},
				#{patentNum},
				#{profile},
				now(),
				#{regNum},
				#{userSeq},
				'Y',
				#{userId},
				#{userSeq},
				#{googleMapLink},
				#{subMngerNm},
				#{subMngerPosition},
				#{subMngerCell},
				#{subMngerEmail}
		)
    </insert>

	<!-- insertInstitution -->
    <insert id="insertInstitution" parameterType="ony.cpes.external.member.bean.InstitutionBean">
		/*setMember.insertInstitution*/
		<selectKey resultType="string" keyProperty="insttSeq" order="BEFORE">
        	SELECT FN_GET_UUID_SEQ() AS STR FROM DUAL
    	</selectKey>
		INSERT INTO CPES_INSTT
			(
				DEL_YN,
				FILE_GRP_SEQ,
				INSTT_ADDR_CD,
				INSTT_ADDR_DTL,
				INSTT_ADDR_FULL_CD,
				INSTT_ADDR_FULL_NM,
				INSTT_CELL,
				INSTT_CONTENT,
				INSTT_EMAIL,
				INSTT_FAX,
				INSTT_MNGER_NM,
				INSTT_NM_EN,
				INSTT_NM_KH,
				INSTT_OFFICE_TEL,
				INSTT_OWNER_CD,
				INSTT_OWNER_NM,
				INSTT_REG_NUM,
				INSTT_SEQ,
				INSTT_STS_CD,
				INSTT_TYPE_CD,
				INSTT_WEBSITE,
				MOD_DT,
				MOD_USER_SEQ,
				REG_DT,
				REG_USER_SEQ,
				USER_SEQ,
				BKMK_CNT
		) VALUES (
				'N',
				#{fileGrpSeq},
				#{insttAddrCd},
				#{insttAddrDtl},
				#{insttAddrFullCd},
				#{insttAddrFullNm},
				#{insttCell},
				#{insttContent},
				#{insttEmail},
				#{insttFax},
				#{insttMngerNm},
				#{insttNmEn},
				#{insttNmKh},
				#{insttOfficeTel},
				#{insttOwnerCd},
				#{insttOwnerNm},
				#{insttRegNum},
				#{insttSeq},
				'ITS0000000000',
				#{insttTypeCd},
				#{insttWebsite},
				now(),
				#{userSeq},
				now(),
				#{userSeq},
				#{userSeq},
				0
		)
    </insert>

    <update id="updateMemberImg" parameterType="ony.cpes.external.member.bean.MemberBean">
    	UPDATE CPES_USER
    	SET MOD_DT = NOW()
    	, MOD_USER_SEQ = #{modUserSeq}
    	, FILE_GRP_SEQ = #{fileGrpSeq}
    	WHERE USER_SEQ = #{userSeq}
    </update>

</mapper>
